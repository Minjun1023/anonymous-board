<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµëª… ê²Œì‹œíŒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* body background removed to support dark mode */
        .feature-icon {
            font-size: 2rem;
            color: #0d6efd;
            margin-bottom: 1rem;
        }

        .main-content {
            min-height: calc(100vh - 100px);
            padding: 4rem 0;
        }
    </style>
</head>

<body>
    <div th:replace="~{fragments/layout :: navigation}"></div>

    <div class="main-content">
        <div class="container">
            <div class="text-center mb-5">
                <h1 class="display-4 mb-3">ìµëª… ê²Œì‹œíŒì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</h1>
                <p class="lead text-muted">ììœ ë¡­ê²Œ ì˜ê²¬ì„ ë‚˜ëˆ„ê³  ì†Œí†µí•˜ì„¸ìš”</p>
                <div class="d-grid gap-2 col-6 mx-auto mt-4">
                    <a href="/posts" class="btn btn-primary btn-lg">ê²Œì‹œê¸€ ë³´ê¸°</a>
                </div>
            </div>

            <!-- ğŸ”¥ ì¸ê¸°ê¸€ ì„¹ì…˜ -->
            <div class="row mt-5" th:if="${hotPosts != null and !hotPosts.isEmpty()}">
                <div class="col-12">
                    <h2 class="h3 mb-4 text-center">ğŸ”¥ ì¸ê¸°ê¸€</h2>
                    <div class="list-group">
                        <a th:each="post : ${hotPosts}" th:href="@{/posts/{id}(id=${post.id})}"
                            class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <h5 class="mb-1" th:text="${post.title}">ê²Œì‹œê¸€ ì œëª©</h5>
                                <div class="d-flex gap-3 text-muted small">
                                    <span>ğŸ‘ï¸ <span th:text="${post.viewCount}">0</span></span>
                                    <span>ğŸ‘ <span th:text="${post.likes}">0</span></span>
                                    <span>ğŸ’¬ <span th:text="${post.commentCount}">0</span></span>
                                </div>
                            </div>
                            <p class="mb-1 text-muted small" th:text="${#strings.abbreviate(post.content, 100)}">ê²Œì‹œê¸€ ë‚´ìš©
                                ë¯¸ë¦¬ë³´ê¸°...</p>
                        </a>
                    </div>
                </div>
            </div>

            <!-- ğŸ“Œ ìµœê·¼ ê²Œì‹œê¸€ ì„¹ì…˜ -->
            <div class="row mt-5" th:if="${recentPosts != null and !recentPosts.isEmpty()}">
                <div class="col-12">
                    <h2 class="h3 mb-4 text-center">ğŸ“Œ ìµœê·¼ ê²Œì‹œê¸€</h2>
                    <div class="list-group">
                        <a th:each="post : ${recentPosts}" th:href="@{/posts/{id}(id=${post.id})}"
                            class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <h5 class="mb-1" th:text="${post.title}">ê²Œì‹œê¸€ ì œëª©</h5>
                                <div class="d-flex gap-3 text-muted small">
                                    <span>ğŸ‘ï¸ <span th:text="${post.viewCount}">0</span></span>
                                    <span>ğŸ‘ <span th:text="${post.likes}">0</span></span>
                                    <span>ğŸ’¬ <span th:text="${post.commentCount}">0</span></span>
                                </div>
                            </div>
                            <p class="mb-1 text-muted small" th:text="${#strings.abbreviate(post.content, 100)}">ê²Œì‹œê¸€ ë‚´ìš©
                                ë¯¸ë¦¬ë³´ê¸°...</p>
                        </a>
                    </div>
                </div>
            </div>

            <!-- ê¸°ëŠ¥ ì†Œê°œ ì„¹ì…˜ -->
            <div class="row g-4 py-5">
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="feature-icon">
                                <i class="bi bi-shield-lock"></i>
                            </div>
                            <h3 class="card-title h5">ìµëª…ì„± ë³´ì¥</h3>
                            <p class="card-text text-muted">ì•ˆì „í•˜ê³  ììœ ë¡œìš´ ì†Œí†µì„ ìœ„í•´ ìµëª…ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="feature-icon">
                                <i class="bi bi-chat-dots"></i>
                            </div>
                            <h3 class="card-title h5">ì‹¤ì‹œê°„ ì†Œí†µ</h3>
                            <p class="card-text text-muted">ì±„íŒ…ì„ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒëŒ€ë°©ê³¼ ëŒ€í™”ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body text-center">
                            <div class="feature-icon">
                                <i class="bi bi-person-check"></i>
                            </div>
                            <h3 class="card-title h5">ì†Œì…œ ë¡œê·¸ì¸</h3>
                            <p class="card-text text-muted">ì¹´ì¹´ì˜¤, êµ¬ê¸€, ë„¤ì´ë²„ë¡œ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/layout :: footer}"></div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script>
        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', async function () {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');

            // ê¸°ë³¸ê°’: ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ
            if (loginBtn) loginBtn.style.display = 'block';
            if (logoutBtn) logoutBtn.style.display = 'none';

            try {
                // ì„œë²„ì— ì¸ì¦ ìƒíƒœ í™•ì¸
                const response = await fetch('/api/users/me', {
                    credentials: 'include'
                });

                if (response.ok) {
                    // ë¡œê·¸ì¸ ìƒíƒœ
                    console.log('Index page - User is authenticated');
                    if (loginBtn) loginBtn.style.display = 'none';
                    if (logoutBtn) logoutBtn.style.display = 'block';
                } else {
                    // ë¹„ë¡œê·¸ì¸ ìƒíƒœ
                    console.log('Index page - User is not authenticated');
                }
            } catch (error) {
                console.error('Failed to check authentication:', error);
            }
        });
    </script>
</body>

</html>