<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ëª©ë¡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        .announcement-card-body {
            background: linear-gradient(to right, #fff5f5, #ffffff);
            border-left: 4px solid #dc3545;
        }

        [data-bs-theme="dark"] .announcement-card-body {
            background: linear-gradient(to right, #391114, #212529);
            border-left: 4px solid #dc3545;
        }
    </style>
</head>

<body>
    <div th:replace="~{fragments/layout :: navigation}"></div>

    <div class="container mt-4">
        <div class="d-flex justify-content-between mb-3">
            <h2>ê²Œì‹œê¸€ ëª©ë¡</h2>
            <div>
                <a href="#" id="writePostBtn" class="btn btn-primary">ê¸€ ì‘ì„±</a>
            </div>
        </div>

        <!-- ê²Œì‹œíŒ íƒ€ì… íƒ­ -->
        <ul class="nav nav-tabs mb-3" id="boardTabs">
            <li class="nav-item">
                <a class="nav-link" href="/posts?boardType=notice" data-board-type="notice">ğŸ“¢ ê³µì§€ì‚¬í•­</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/posts?boardType=free" data-board-type="free">ğŸ—¨ï¸ ììœ ê²Œì‹œíŒ</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/posts?boardType=secret" data-board-type="secret">ğŸ”’ ë¹„ë°€ê²Œì‹œíŒ</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/posts?boardType=qna" data-board-type="qna">â“ QnAê²Œì‹œíŒ</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/posts/hot">ğŸ”¥ í•« ê²Œì‹œíŒ</a>
            </li>
        </ul>

        <div class="row mb-3">
            <div class="col-md-8">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary active" data-sort="viewCount">ì¡°íšŒìˆœ</button>
                    <button type="button" class="btn btn-outline-secondary" data-sort="comments">ëŒ“ê¸€ìˆœ</button>
                </div>
            </div>
            <div class="col-md-4">
                <div class="input-group">
                    <input type="text" class="form-control" id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    <button class="btn btn-outline-secondary" type="button" onclick="searchPosts()">ê²€ìƒ‰</button>
                </div>
            </div>
        </div>

        <div id="postsContainer">
            <p class="text-center my-5">ë¡œë”© ì¤‘...</p>
        </div>
    </div>

    <div th:replace="~{fragments/layout :: footer}"></div>

    <script>
        let currentSort = 'viewCount';  // ê¸°ë³¸ ì •ë ¬ì„ ì¡°íšŒìˆœìœ¼ë¡œ ë³€ê²½
        let currentBoardType = '[[${currentBoardType}]]' || 'free';  // Thymeleafë¡œë¶€í„° ë°›ì€ boardType, ê¸°ë³¸ê°’ì€ ììœ ê²Œì‹œíŒ

        document.addEventListener('DOMContentLoaded', function () {
            // í˜„ì¬ boardTypeì— ë§ëŠ” íƒ­ í™œì„±í™”
            const activeTab = document.querySelector(`[data-board-type="${currentBoardType}"]`);
            if (activeTab) {
                document.querySelectorAll('#boardTabs .nav-link').forEach(link => link.classList.remove('active'));
                activeTab.classList.add('active');
            }

            loadPosts();

            // ê¸€ ì‘ì„± ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.getElementById('writePostBtn').addEventListener('click', async function (e) {
                e.preventDefault();

                try {
                    const response = await fetch('/api/users/me', {
                        credentials: 'include'
                    });

                    if (response.ok) {
                        // ë¡œê·¸ì¸ ìƒíƒœë©´ ê¸€ ì‘ì„± í˜ì´ì§€ë¡œ ì´ë™
                        window.location.href = '/posts/write';
                    } else {
                        // ë¹„ë¡œê·¸ì¸ ìƒíƒœë©´ ì•Œë¦¼ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        window.location.href = '/login';
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    window.location.href = '/login';
                }
            });

            document.querySelectorAll('[data-sort]').forEach(button => {
                button.addEventListener('click', function () {
                    currentSort = this.dataset.sort;
                    document.querySelectorAll('[data-sort]').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    loadPosts();
                });
            });
        });

        async function checkAuthStatus() {
            // ë” ì´ìƒ í•„ìš” ì—†ìŒ - ë²„íŠ¼ì€ í•­ìƒ í‘œì‹œë¨
        }

        function loadPosts(page = 0, size = 10) {
            const params = new URLSearchParams({
                page: page,
                size: size,
                sortBy: currentSort,
                boardType: currentBoardType  // í•­ìƒ boardType í¬í•¨
            });

            console.log('Loading posts - Page:', page, 'Size:', size, 'Sort:', currentSort, 'BoardType:', currentBoardType);

            fetch('/api/posts?' + params.toString(), {
                credentials: 'include'
            })
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch');
                    return response.json();
                })
                .then(data => {
                    console.log('Received data:', data);
                    console.log('Posts array:', data.posts);
                    console.log('Current page:', data.currentPage, 'Total pages:', data.totalPages);

                    const container = document.getElementById('postsContainer');

                    if (!data.posts || data.posts.length === 0) {
                        container.innerHTML = '<p class="text-center my-5">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                        return;
                    }

                    // ê²Œì‹œê¸€ ëª©ë¡ ë Œë”ë§
                    const postsHtml = data.posts.map(post => {
                        const title = String(post.title).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        const content = String(post.content).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        const nickname = String(post.nickname).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        const shortContent = content.length > 100 ? content.substring(0, 100) + '...' : content;
                        const date = post.createdAt.substring(0, 16).replace('T', ' ');

                        const profileImage = post.profileImage || '/profiles/default_profile.png';

                        // ê³µì§€ì‚¬í•­ ì—¬ë¶€ í™•ì¸ (ë””ë²„ê¹…ìš© ë¡œê·¸)
                        if (post.isAnnouncement) {
                            console.log('ê³µì§€ì‚¬í•­ ê²Œì‹œê¸€ ë°œê²¬:', post.title, 'isAnnouncement:', post.isAnnouncement);
                        }

                        // ë¸”ë¼ì¸ë“œ ì²˜ë¦¬ ì—¬ë¶€ í™•ì¸
                        const isBlinded = post.isBlinded || false;

                        // ê³µì§€ì‚¬í•­ ì—¬ë¶€ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ë§ (ë” ëˆˆì— ë„ê²Œ)
                        const cardClass = post.isAnnouncement
                            ? 'card mb-3 border-danger border-3 shadow-sm'
                            : (isBlinded ? 'card mb-3 border-warning border-2' : 'card mb-3');
                        const cardBodyClass = post.isAnnouncement
                            ? 'card-body announcement-card-body'
                            : (isBlinded ? 'card-body bg-warning bg-opacity-10' : 'card-body');
                        const announcementBadge = post.isAnnouncement
                            ? '<span class="badge bg-danger me-2" style="font-size: 0.9rem; padding: 0.4rem 0.8rem;"><i class="bi bi-megaphone-fill"></i> ê³µì§€</span>'
                            : '';

                        // ë¸”ë¼ì¸ë“œëœ ê²Œì‹œê¸€ ì²˜ë¦¬
                        if (isBlinded) {
                            return `
                            <div class="${cardClass}">
                                <div class="${cardBodyClass}">
                                    <h5 class="card-title">
                                        <i class="bi bi-eye-slash-fill text-warning"></i> 
                                        <span class="text-muted">ë¹„ì¶”ì²œì´ ë§ì•„ ìˆ¨ê²¨ì§„ ê²Œì‹œê¸€ì…ë‹ˆë‹¤</span>
                                    </h5>
                                    <p class="card-text text-muted small">
                                        ì´ ê²Œì‹œê¸€ì€ ë¹„ì¶”ì²œ ìˆ˜ê°€ ë§ì•„ ë‚´ìš©ì´ ê°€ë ¤ì¡ŒìŠµë‹ˆë‹¤. 
                                        í™•ì¸í•˜ì‹œë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                                    </p>
                                    <button class="btn btn-sm btn-outline-warning mb-2" onclick="event.preventDefault(); this.nextElementSibling.style.display='block'; this.style.display='none';">
                                        <i class="bi bi-eye"></i> ë‚´ìš© ë³´ê¸°
                                    </button>
                                    <div style="display: none;">
                                        <h5 class="card-title">
                                            <a href="/posts/${post.id}" class="text-decoration-none">${title}</a>
                                        </h5>
                                        <p class="card-text text-muted">${shortContent}</p>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mt-2">
                                        <div class="d-flex align-items-center">
                                            <img src="${profileImage}" alt="Profile" class="rounded-circle me-2" style="width: 24px; height: 24px; object-fit: cover;">
                                            <small class="text-muted">ì‘ì„±ì: ${nickname}</small>
                                        </div>
                                        <div>
                                            <span class="me-3">
                                                <i class="bi bi-hand-thumbs-up"></i> ${post.likes || 0}
                                            </span>
                                            <span class="me-3 text-danger">
                                                <i class="bi bi-hand-thumbs-down"></i> ${post.dislikes || 0}
                                            </span>
                                            <span class="me-3">
                                                <i class="bi bi-eye"></i> ${post.viewCount || 0}
                                            </span>
                                            <span class="me-3">
                                                <i class="bi bi-chat"></i> ${post.commentCount || 0}
                                            </span>
                                            <small class="text-muted">${date}</small>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                        }

                        return `
                        <div class="${cardClass}">
                            <div class="${cardBodyClass}">
                                <h5 class="card-title">
                                    ${announcementBadge}<a href="/posts/${post.id}" class="text-decoration-none ${post.isAnnouncement ? 'fw-bold' : ''}">${title}</a>
                                </h5>
                                <p class="card-text text-muted">${shortContent}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        <img src="${profileImage}" alt="Profile" class="rounded-circle me-2" style="width: 24px; height: 24px; object-fit: cover;">
                                        <small class="text-muted">ì‘ì„±ì: ${nickname}</small>
                                    </div>
                                    <div>
                                        <span class="me-3">
                                            <i class="bi bi-hand-thumbs-up"></i> ${post.likes || 0}
                                        </span>
                                        <span class="me-3">
                                            <i class="bi bi-hand-thumbs-down"></i> ${post.dislikes || 0}
                                        </span>
                                        <span class="me-3">
                                            <i class="bi bi-eye"></i> ${post.viewCount || 0}
                                        </span>
                                        <span class="me-3">
                                            <i class="bi bi-chat"></i> ${post.commentCount || 0}
                                        </span>
                                        <small class="text-muted">${date}</small>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    }).join('');

                    // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
                    const pagination = renderPagination(data);

                    container.innerHTML = postsHtml + pagination;
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('postsContainer').innerHTML =
                        '<div class="alert alert-danger">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
                });
        }

        function renderPagination(data) {
            if (data.totalPages <= 1) return '';

            let html = '<nav aria-label="Page navigation" class="mt-4"><ul class="pagination justify-content-center">';

            // ì´ì „ ë²„íŠ¼
            html += `<li class="page-item ${!data.hasPrevious ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="loadPosts(${data.currentPage - 1}); return false;">ì´ì „</a>
            </li>`;

            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            const startPage = Math.max(0, data.currentPage - 2);
            const endPage = Math.min(data.totalPages - 1, data.currentPage + 2);

            for (let i = startPage; i <= endPage; i++) {
                html += `<li class="page-item ${i === data.currentPage ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="loadPosts(${i}); return false;">${i + 1}</a>
                </li>`;
            }

            // ë‹¤ìŒ ë²„íŠ¼
            html += `<li class="page-item ${!data.hasNext ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="loadPosts(${data.currentPage + 1}); return false;">ë‹¤ìŒ</a>
            </li>`;

            html += '</ul></nav>';
            return html;
        }

        function searchPosts(page = 0) {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) {
                loadPosts();
                return;
            }

            const params = new URLSearchParams({
                keyword: searchTerm,
                page: page,
                size: 10
            });

            fetch('/api/posts/search?' + params.toString(), {
                credentials: 'include'
            })
                .then(response => {
                    if (!response.ok) throw new Error('Search failed');
                    return response.json();
                })
                .then(data => {
                    const container = document.getElementById('postsContainer');

                    if (!data.content || data.content.length === 0) {
                        container.innerHTML = '<p class="text-center my-5">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                        return;
                    }

                    const postsHtml = data.content.map(post => {
                        const title = String(post.title).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        const content = String(post.content).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        const nickname = String(post.nickname).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        const shortContent = content.length > 100 ? content.substring(0, 100) + '...' : content;
                        const date = post.createdAt.substring(0, 16).replace('T', ' ');

                        const profileImage = post.profileImage || '/profiles/default_profile.png';

                        // ë¸”ë¼ì¸ë“œ ì²˜ë¦¬ ì—¬ë¶€ í™•ì¸
                        const isBlinded = post.isBlinded || false;

                        // ê³µì§€ì‚¬í•­ ì—¬ë¶€ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ë§ (ë” ëˆˆì— ë„ê²Œ)
                        const cardClass = post.isAnnouncement
                            ? 'card mb-3 border-danger border-3 shadow-sm'
                            : (isBlinded ? 'card mb-3 border-warning border-2' : 'card mb-3');
                        const cardBodyStyle = post.isAnnouncement
                            ? 'background: linear-gradient(to right, #fff5f5, #ffffff); border-left: 4px solid #dc3545;'
                            : '';
                        const cardBodyClass = isBlinded ? 'bg-warning bg-opacity-10' : '';
                        const announcementBadge = post.isAnnouncement
                            ? '<span class="badge bg-danger me-2" style="font-size: 0.9rem; padding: 0.4rem 0.8rem;"><i class="bi bi-megaphone-fill"></i> ê³µì§€</span>'
                            : '';

                        // ë¸”ë¼ì¸ë“œëœ ê²Œì‹œê¸€ ì²˜ë¦¬
                        if (isBlinded) {
                            return `
                            <div class="${cardClass}">
                                <div class="card-body ${cardBodyClass}">
                                    <h5 class="card-title">
                                        <i class="bi bi-eye-slash-fill text-warning"></i> 
                                        <span class="text-muted">ë¹„ì¶”ì²œì´ ë§ì•„ ìˆ¨ê²¨ì§„ ê²Œì‹œê¸€ì…ë‹ˆë‹¤</span>
                                    </h5>
                                    <p class="card-text text-muted small">
                                        ì´ ê²Œì‹œê¸€ì€ ë¹„ì¶”ì²œ ìˆ˜ê°€ ë§ì•„ ë‚´ìš©ì´ ê°€ë ¤ì¡ŒìŠµë‹ˆë‹¤. 
                                        í™•ì¸í•˜ì‹œë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                                    </p>
                                    <button class="btn btn-sm btn-outline-warning mb-2" onclick="event.preventDefault(); this.nextElementSibling.style.display='block'; this.style.display='none';">
                                        <i class="bi bi-eye"></i> ë‚´ìš© ë³´ê¸°
                                    </button>
                                    <div style="display: none;">
                                        <h5 class="card-title">
                                            <a href="/posts/${post.id}" class="text-decoration-none">${title}</a>
                                        </h5>
                                        <p class="card-text text-muted">${shortContent}</p>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mt-2">
                                        <div class="d-flex align-items-center">
                                            <img src="${profileImage}" alt="Profile" class="rounded-circle me-2" style="width: 24px; height: 24px; object-fit: cover;">
                                            <small class="text-muted">ì‘ì„±ì: ${nickname}</small>
                                        </div>
                                        <div>
                                            <span class="me-3">
                                                <i class="bi bi-hand-thumbs-up"></i> ${post.likes || 0}
                                            </span>
                                            <span class="me-3 text-danger">
                                                <i class="bi bi-hand-thumbs-down"></i> ${post.dislikes || 0}
                                            </span>
                                            <span class="me-3">
                                                <i class="bi bi-eye"></i> ${post.viewCount || 0}
                                            </span>
                                            <span class="me-3">
                                                <i class="bi bi-chat"></i> ${post.commentCount || 0}
                                            </span>
                                            <small class="text-muted">${date}</small>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                        }

                        return `
                        <div class="${cardClass}">
                            <div class="card-body" style="${cardBodyStyle}">
                                <h5 class="card-title">
                                    ${announcementBadge}<a href="/posts/${post.id}" class="text-decoration-none ${post.isAnnouncement ? 'fw-bold' : ''}">${title}</a>
                                </h5>
                                <p class="card-text text-muted">${shortContent}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        <img src="${profileImage}" alt="Profile" class="rounded-circle me-2" style="width: 24px; height: 24px; object-fit: cover;">
                                        <small class="text-muted">ì‘ì„±ì: ${nickname}</small>
                                    </div>
                                    <div>
                                        <span class="me-3">
                                            <i class="bi bi-hand-thumbs-up"></i> ${post.likes || 0}
                                        </span>
                                        <span class="me-3">
                                            <i class="bi bi-hand-thumbs-down"></i> ${post.dislikes || 0}
                                        </span>
                                        <span class="me-3">
                                            <i class="bi bi-eye"></i> ${post.viewCount || 0}
                                        </span>
                                        <span class="me-3">
                                            <i class="bi bi-chat"></i> ${post.commentCount || 0}
                                        </span>
                                        <small class="text-muted">${date}</small>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    }).join('');

                    const pagination = renderSearchPagination(data, searchTerm);
                    container.innerHTML = postsHtml + pagination;
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('postsContainer').innerHTML =
                        '<div class="alert alert-danger">ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
                });
        }

        function renderSearchPagination(data, searchTerm) {
            if (data.totalPages <= 1) return '';

            let html = '<nav aria-label="Page navigation" class="mt-4"><ul class="pagination justify-content-center">';

            html += `<li class="page-item ${data.first ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="searchPosts(${data.number - 1}); return false;">ì´ì „</a>
            </li>`;

            const startPage = Math.max(0, data.number - 2);
            const endPage = Math.min(data.totalPages - 1, data.number + 2);

            for (let i = startPage; i <= endPage; i++) {
                html += `<li class="page-item ${i === data.number ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="searchPosts(${i}); return false;">${i + 1}</a>
                </li>`;
            }

            html += `<li class="page-item ${data.last ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="searchPosts(${data.number + 1}); return false;">ë‹¤ìŒ</a>
            </li>`;

            html += '</ul></nav>';
            return html;
        }

        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') searchPosts();
        });
    </script>

    <!-- Floating Inquiry Button (only for authenticated users) -->
    <div sec:authorize="isAuthenticated()" style="position: fixed; bottom: 30px; right: 30px; z-index: 1000;">
        <button class="btn btn-primary btn-lg rounded-circle shadow" data-bs-toggle="modal"
            data-bs-target="#inquiryModal" style="width: 60px; height: 60px; padding: 0;">
            <i class="bi bi-question-circle" style="font-size: 1.5rem;"></i>
        </button>
    </div>

    <!-- Inquiry Modal -->
    <div class="modal fade" id="inquiryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ê¸°</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="inquiryForm">
                        <div class="mb-3">
                            <label for="inquiryTitle" class="form-label">ì œëª© <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="inquiryTitle" placeholder="ë¬¸ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                maxlength="200" required>
                        </div>
                        <div class="mb-3">
                            <label for="inquiryContent" class="form-label">ë‚´ìš© <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="inquiryContent" rows="5" placeholder="ë¬¸ì˜ ë‚´ìš©ì„ ìì„¸íˆ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                maxlength="2000" required></textarea>
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> ê´€ë¦¬ì í™•ì¸ í›„ ë‹µë³€ë“œë¦½ë‹ˆë‹¤.
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="submitInquiry()">
                        <i class="bi bi-send"></i> ë¬¸ì˜í•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function submitInquiry() {
            const title = document.getElementById('inquiryTitle').value.trim();
            const content = document.getElementById('inquiryContent').value.trim();

            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            fetch('/api/inquiries', {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ title, content })
            })
                .then(async response => {
                    if (response.status === 401) {
                        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        window.location.href = '/login';
                        return;
                    }
                    if (response.ok) {
                        const data = await response.json();
                        alert(data.message || 'ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.');

                        // Reset form
                        document.getElementById('inquiryTitle').value = '';
                        document.getElementById('inquiryContent').value = '';

                        // Close modal
                        const modal = bootstrap.Modal.getInstance(document.getElementById('inquiryModal'));
                        modal.hide();
                    } else {
                        const data = await response.json();
                        throw new Error(data.message || 'ë¬¸ì˜ ì ‘ìˆ˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert(error.message);
                });
        }
    </script>
</body>

</html>